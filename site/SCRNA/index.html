<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://neurobioinfo.github.io/SCRNA/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>- Standard scRNA - scrnabox</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "- Standard scRNA";
        var mkdocs_page_input_path = "SCRNA.md";
        var mkdocs_page_url = "/SCRNA/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> scrnabox
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutorial</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">- Standard scRNA</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../HTO/">- Cell hashtags</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../PROC/">- Processed Data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Dataset1/">- Dataset1</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Dataset2/">- Dataset2</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../FAQ/">FAQ</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../reference/">Reference</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../LICENSE/">- License</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../changelog/">- Changelog</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../contributing/">- Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Acknowledgement/">- Acknowledgement</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">scrnabox</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>Tutorial &raquo;</li>
      <li class="breadcrumb-item active">- Standard scRNA</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="scrnabox-pipeline-standard-scrnaseq-analysis-track">ScRNAbox pipeline: Standard scRNAseq Analysis Track</h2>
<h2 id="contents">Contents</h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#setup">Setup</a></li>
<li><a href="#step-1-fastq-pre-processing">Step 1: FASTQ pre-processing</a></li>
<li><a href="#step-2-ambient-rna-removal-and-create-seurat-object">Step 2: Ambient RNA removal and create Seurat object</a>  </li>
<li><a href="#step-3-quality-control-and-filtering">Step 3: Quality control and filtering</a></li>
<li><a href="#step-4-doublet-removal">Step 4: Doublet removal</a></li>
<li><a href="#step-5-integration-and-linear-dimensional-reduction">Step 5: Integration and linear dimensional reduction</a></li>
<li><a href="#step-6-clustering">Step 6: Clustering</a>   </li>
<li><a href="#step-7-cluster-annotation">step 7: Cluster annotation</a>    </li>
<li><a href="#step-8-differential-gene-expression-contrasts">step 8: Differential gene expression contrasts</a>     </li>
<li><a href="#integrating-seurat-objects">Integrating Seurat objects</a>  </li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>This guide provides instructions for analyzing single-cell RNA sequencing (scRNAseq) data using the Standard Analysis Track of the scRNAbox pipeline. The Standard Analysis Track is designed for scRNAseq experiments where each sample is captured and sequenced separately; thus, users should have unique FASTQ files for each of the samples in their experiment. If instead samples were pooled prior to sequencing, resulting in FASTQ files comprising scRNAseq data of multiple samples, users should leverage the <a href="../HTO/">Cell Hashtag scRNAseq</a> Analysis Track.<br /> </p>
<p>The main component of the scRNAbox pipeline is <code>scrnabox.slurm</code>, which is an open-source pipeline for scRNAseq analysis that is specifically designed to run on high-performance computing (HPC) systems using the <a href="https://slurm.schedmd.com/">Slurm Workload Manager</a>. <code>scrnabox.slurm</code> outlines the Analytical Steps involved in a comprehensive scRNAseq analysis workflow, including FASTQ pre-processing, quality control and filtering, clustering, cluster annotation, and differential gene expression contrasts. The Analytical Steps involved in the Standard Analysis Track of the scRNAbox pipeline are outlined in the figure below.<br />  </p>
<p><img src="https://github.com/neurobioinfo/scrnabox/assets/110110777/328966c3-04dc-4e42-91cb-c6181026d1d6" width="550" height="100"></p>
<p><strong>Note:</strong> This tutorial assumes that <code>scrnabox.slurm</code>,<code>cellranger</code>, <code>R</code>, and the required R packages have already been installed onto the HPC system. If this is not the case, please visit <a href="../installation/">Installation</a> to do so before proceeding. If the required packages are installed, you can proceed to <a href="#setup">Setup</a>.</p>
<h3 id="setup">Setup</h3>
<p>Before running the pipeline, create a dedicated folder for the analysis (hereafter referred to as the working directory). Then, define the path of the working directory (<code>SCRNABOX_PWD=</code>) and the path to <code>scrnabox.slurm</code> (<code>SCRNABOX_HOME=</code>). For example:</p>
<pre><code>mkdir ~/working_directory
cd ~/working_directory 
export SCRNABOX_HOME=~/scrnabox.slurm
export SCRNABOX_PWD=~/working_directory
</code></pre>
<p>For a description of the options for running <code>scrnabox.slurm</code> and to ensure that the path was properly defined, run the following command:</p>
<pre><code>bash $SCRNABOX_HOME/launch_scrnabox.sh -h 
</code></pre>
<p>If the pipeline has been installed properly, the above command should return the folllowing:</p>
<pre><code>        mandatory arguments:
                -d  (--dir)  = Working directory (where all the outputs will be printed) (give full path)
                --steps  =  Specify what steps, e.g., 2 to run just step 2, 2-4, run steps 2 through 4)

        optional arguments:
                -h  (--help)  = See helps regarding the pipeline options. 
                --method  = Choose what scRNA method you want to use; use HTO  and SCRNA for for hashtag nad Standard scRNA, respectively. 
                --nFeature_RNA_L  = Lower threshold of number of unique RNA transcripts for each cell, it filters nFeature_RNA &gt; nFeature_RNA_L.  
                --nFeature_RNA_U  = Upper threshold of number of unique RNA transcripts for each cell, it filters --nFeature_RNA_U.  
                --nCount_RNA_L  = Lower threshold for nCount_RNA, it filters nCount_RNA &gt; nCount_RNA_L   
                --nCount_RNA_U  = Upper threshold for  nCount_RNA, it filters nCount_RNA &lt; nCount_RNA_U  
                --mitochondria_percent_L  = Lower threshold for the amount of mitochondrial transcript, it is in percent, mitochondria_percent &gt; mitochondria_percent_L. 
                --mitochondria_percent_U  = Upper threshold for the amount of mitochondrial transcript, it is in percent, mitochondria_percent &lt; mitochondria_percent_U. 
                --log10GenesPerUMI_U  = Upper threshold for the log number of genes per UMI for each cell, it is in percent,log10GenesPerUMI=log10(nFeature_RNA)/log10(nCount_RNA). mitochondria_percent &lt; log10GenesPerUMI_U. 
                --log10GenesPerUMI_L  = Lower threshold for the log number of genes per UMI for each cell, log10GenesPerUMI=log10(nFeature_RNA)/log10(nCount_RNA). mitochondria_percent &gt; log10GenesPerUMI_L.  
                --msd  = you can get the hashtag labels by running the following code 
                --marker  = Find marker. 
                --sinfo  = Do you need sample info? 
                --fta  = FindTransferAnchors 
                --enrich  = Annotation 
                --dgelist  = creates a DGEListobject from a table of counts obtained from seurate objects. 
                --genotype  = Run the genotype contrast. 
                --celltype  = Run the Genotype-cell contrast. 
                --cont  = You can directly call the contrast to the pipeline.  
                --seulist                = You can directly call the list of seurat objects to the pipeline. 
</code></pre>
<p>Next, run the pipeline initiation Step (<code>--steps 0</code>) and define the Standard scRNAseq Analysis Track (<code>--method SCRNA</code>) using the following command from the working directory:</p>
<pre><code>cd ~/working_directory 

bash $SCRNABOX_HOME/launch_scrnabox.sh \
-d ${SCRNABOX_PWD} \
--steps 0 \
--method SCRNA
</code></pre>
<p>After running the pipeline initiation Step, the structure of the working directory should be as follows:</p>
<pre><code>├── working_directory
    ├── job_info
        ├── configs
        ├── logs
        ├── parameters
</code></pre>
<ul>
<li>The <code>configs/</code> directory contains the <code>scrnabox_config.ini</code> file which allows users to specify their job allocations (memory, threads, and walltime) for each Analytical Step using the Slurm Workload Manager; <br /> </li>
<li>The <code>logs/</code> directory records the events of each Analytical Step; <br /></li>
<li>The <code>parameters/</code> directory contains adjustable, Step-specific text files which allow users to define the execution parameters for each Analytical Step. <br /></li>
</ul>
<p>Next, navigate to the <code>scrnabox_config.ini</code> file in <code>~/working_directory/job_info/configs</code> to define the path to the R library (<code>R_LIB_PATH=</code>), the version of R (<code>R_VERSION=</code>), and the path to CellRanger (<code>MODULECELLRANGER=</code>). For example: </p>
<pre><code>MODULECELLRANGER=mugqic/cellranger/5.0.1
R_VERSION=4.2.1
R_LIB_PATH=Path_to_R_library
</code></pre>
<p>Finally, in preparation for Step 1 (FASTQ pre-processing with CellRanger) users must create <code>library.csv</code> files for each of their samples, which defines the necessary information of the FASTQ files for the experiment. The structure of the <code>library.csv</code> file should be: <br /></p>
<pre><code>fastqs,sample,library_type
~/fastqs/,CTRL1,Gene Expression
</code></pre>
<ul>
<li>The <code>fastqs</code> column defines the path to the directory that contains the FASTQ files for the experiment. <br /> </li>
<li>The <code>sample</code> column defines the sample name of the corresponding FASTQ file. Please note that FASTQ files must be named according to standard CellRanger nomenclature. For example, "CTRL1_S1_L001_R1_001.fastq". For more information please visit CellRanger's <a href="https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/using/fastq-input">documentation</a>. <br /></li>
<li>The <code>library_type</code> column defines the assay type. For The Standard Analysis Track of scRNAbox, <code>library_type</code> will always be "Gene Expression". <br /></li>
</ul>
<p>For example, if the experiment comprises four samples (two controls and two cases) the following steps should be taken: <br /></p>
<p>1) Navigate to the working directory and create a <code>samples_info</code> folder: <br /></p>
<pre><code>cd ~/working_directory
mkdir samples_info
</code></pre>
<p>2) Navigate to the <code>samples_info</code> folder and create a folder for each sample. Please note that the sample names used here will eventually be used to define samples in the Seurat object, so choose them wisely: <br /></p>
<pre><code>cd samples_info
mkdir control1
mkdir control2
mkdir case1
mkdir case2
</code></pre>
<p>3) Navigate to the folder for each sample and create the <code>library.csv</code> file. <br /></p>
<p>After performing steps 1-3 above, the structure of the samples_info folder for an experiment with four samples should be:</p>
<pre><code>├── working_directory
    ├── samples_info
        ├── control1
            ├── library.csv
        ├── control2
            ├── library.csv
        ├── case1
            ├── library.csv
        ├── case2
            ├── library.csv
</code></pre>
<p>Upon completing the above steps to setup the pipeline, users can run their analysis. Please note that if you do not have access to FASTQ files for your experiment, you may intiate the pipeline at which ever Analytical Step takes your data object as input. In the case where FASTQ files are not available, users do not have to create the <code>samples_info</code> folder. For more information see <a href="../PROC/">Processed Data</a>.  </p>
<h3 id="scrnabox-analytical-steps">scRNAbox Analytical Steps</h3>
<p>Specific Analytical Steps are called using the <code>--steps</code> flag. The output of each Analytical Step is deposited into its respective folder within the working directory (e.g. <code>~/working_directory/step1</code>). Prior to running each Analytical Step, users are strongly encouraged to modify the execution parameters of the analysis using the adjustable, Step-specific parameters text files. The parameters text files are located in <code>~/working_directory/job_info/parameters</code>. For instructions on how to modify these text files please see <a href="../FAQ/">FAQ</a>. To ensure replicability, a summary report file documents the execution parameters for each iteration of each analytical Step, which is located in <code>~/working_directory/job_info/summary_report.txt</code>.</p>
<p>For detailed descriptions of each Analytical Step please see our pre-print manuscript. </p>
<h3 id="step-1-fastq-pre-processing">Step 1: FASTQ pre-processing</h3>
<p>In this step, feature-barcode expression matrices are generated from FASTQ files using the CellRanger <em>counts</em> pipeline. Given that CellRanger runs a user interface, it is recommended to run Step 1 in a 'screen'. <br />
<br />
The following parameters are adjustable for Step 1:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Default</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">REF_DIR_GRCH</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">Path to reference genome for FASTQ alignment. 10X Genomics reference genomes are available for download. For more information see their <a href="https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/using/tutorial_ct">documentation</a>.</td>
</tr>
<tr>
<td style="text-align: left;">R1LENGTH</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">Minimum number of bases to retain for R1 sequence of gene expression</td>
</tr>
<tr>
<td style="text-align: left;">MEMPERCORE</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">For clusters whose job managers do not support memory requests, it is possible to request memory in the form of cores. This option will scale up the number of threads requested via the <strong>MRO_THREADS</strong> variable according to how much memory a stage requires when given to the ratio of memory on your nodes.</td>
</tr>
</tbody>
</table>
<p>To run Step 1, use the following command:</p>
<pre><code>screen -S run_scrnabox
bash $SCRNABOX_HOME/launch_scrnabox.sh \
-d ${SCRNABOX_PWD} \
--steps 1
</code></pre>
<p>The resulting output files are deposited into <code>~/working_directory/step1</code></p>
<p><strong>Parameter names need to be updated.</strong></p>
<h3 id="step-2-ambient-rna-removal-and-create-seurat-object">Step 2: Ambient RNA removal and create Seurat object</h3>
<p>In this step, the ambient RNA rate is estimated and the gene expression profiles are corrected for RNA contamination (optional) using SoupX (Young et al. 2020). Then, CellRanger- or SoupX-generated feature-barcode expression matrices are transformed into Seurat objects. Genes expressed in less than a minimum number of cells and cells expressing less than a minimum number of genes can be filtered.<br />
<br />
The following parameters are adjustable for Step 2:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Default</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">par_save_RNA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether or not to export an RNA expression matrix</td>
</tr>
<tr>
<td style="text-align: left;">par_save_metadata</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether or not to export a metadata dataframe</td>
</tr>
<tr>
<td style="text-align: left;">par_ambient_RNA</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Whether or not to correct the feature-barcode expression matrices for ambient RNA contamination</td>
</tr>
<tr>
<td style="text-align: left;">par_count_matrices</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">If users skipped Step 1, the may provide the path to a directory that contains existing feature-barcode expression matrices to initiate the pipeline at Step 2</td>
</tr>
<tr>
<td style="text-align: left;">par_min.cells_L</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">Only retain genes expressed in a minimum number of cells</td>
</tr>
<tr>
<td style="text-align: left;">par_min.features_L</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">Only retain cells expressing a minimum number of genes</td>
</tr>
</tbody>
</table>
<p>To run Step 2, use the following command:</p>
<pre><code>bash $SCRNABOX_HOME/launch_scrnabox.sh \
-d ${SCRNABOX_PWD} \
--steps 2
</code></pre>
<p>The resulting output files are deposited into <code>~/working_directory/step2</code></p>
<h3 id="step-3-quality-control-and-filtering">Step 3: Quality control and filtering</h3>
<p>Low quality cells are filtered based on the user-defined thresholds for the number of genes detected per cell, number of unique transcripts detected per cell, percentage of mitochondrial-encoded transcripts, and percentage of ribosomal-encoded transcripts. Mitochondrial- and ribosomal-encoded genes can be filtered out, as well as a custom user-defined list of genes. Finally, normalization and scaling is performed on the individual Seurat objects prior to cell-cycle scoring. <br />
<br />
The following parameters are adjustable for Step 3:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Default</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">par_save_RNA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether or not to export an RNA expression matrix</td>
</tr>
<tr>
<td style="text-align: left;">par_save_metadata</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether or not to export a metadata dataframe</td>
</tr>
<tr>
<td style="text-align: left;">par_seurat_object</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">If users skipped Steps 1 and 2, the may provide the path to a directory that contains existing Seurat objects to initiate the pipeline at Step 3</td>
</tr>
<tr>
<td style="text-align: left;">par_nFeature_RNA_L</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">Only retain cells expressing a minimum number of genes</td>
</tr>
<tr>
<td style="text-align: left;">par_nFeature_RNA_U</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">Only retain cells expressing a maximum number of genes</td>
</tr>
<tr>
<td style="text-align: left;">par_nCount_RNA_L</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">Only retain cells with a minimum number of unique transcripts</td>
</tr>
<tr>
<td style="text-align: left;">par_nCount_RNA_U</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">Only retain cells with a maximum number of unique transcripts</td>
</tr>
<tr>
<td style="text-align: left;">par_mitochondria_percent_L</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">Only retain cells with a minimum percentage of mitochondrial genes</td>
</tr>
<tr>
<td style="text-align: left;">par_mitochondria_percent_U</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">Only retain cells with a maximum percentage of mitochondrial genes</td>
</tr>
<tr>
<td style="text-align: left;">par_ribosomal_percent_L</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">Only retain cells with a minimum percentage of ribosomal genes</td>
</tr>
<tr>
<td style="text-align: left;">par_ribosomal_percent_U</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">Only retain cells with a maximum percentage of ribosomal genes</td>
</tr>
<tr>
<td style="text-align: left;">par_log10GenesPerUMI_L</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">Only retain cells with a minimum number of genes per unique molecular identifier</td>
</tr>
<tr>
<td style="text-align: left;">par_log10GenesPerUMI_U</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">Only retain cells with a maximum number of genes per unique molecular identifier</td>
</tr>
<tr>
<td style="text-align: left;">par_remove_mitochondrial_genes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Whether or not to remove mitochondrial genes</td>
</tr>
<tr>
<td style="text-align: left;">par_remove_ribosomal_genes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Whether or not to remove ribosomal genes</td>
</tr>
<tr>
<td style="text-align: left;">par_remove_genes</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">If users want to remove specific genes from their data, they may define a list of gene identifiers</td>
</tr>
<tr>
<td style="text-align: left;">par_normalization.method</td>
<td style="text-align: left;">LogNormalize</td>
<td style="text-align: left;">Method to use for normalization</td>
</tr>
<tr>
<td style="text-align: left;">par_scale.factor</td>
<td style="text-align: left;">10000</td>
<td style="text-align: left;">Scale factor for scaling the data</td>
</tr>
<tr>
<td style="text-align: left;">par_selection.method</td>
<td style="text-align: left;">vst</td>
<td style="text-align: left;">Method for choosing the top variable features</td>
</tr>
<tr>
<td style="text-align: left;">par_nfeatures</td>
<td style="text-align: left;">2500</td>
<td style="text-align: left;">Number of features to select as top variable features</td>
</tr>
<tr>
<td style="text-align: left;">par_top</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">Number of most variable features to be reported in the csv file</td>
</tr>
<tr>
<td style="text-align: left;">par_npcs_pca</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">Total Number of principal components to compute and store for principal component analysis (PCA)</td>
</tr>
<tr>
<td style="text-align: left;">par_cells</td>
<td style="text-align: left;">500</td>
<td style="text-align: left;">Number of cells to include in Seurat's <em>dimheatmap</em> function</td>
</tr>
<tr>
<td style="text-align: left;">par_dims</td>
<td style="text-align: left;">12</td>
<td style="text-align: left;">Number of dimensions to include in Seurat's <em>dimheatmap</em> function</td>
</tr>
<tr>
<td style="text-align: left;">par_dims_umap</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">Number of dimensions to use as input features for uniform manifold approximation and projection (UMAP)</td>
</tr>
<tr>
<td style="text-align: left;">par_n.neighbors</td>
<td style="text-align: left;">65</td>
<td style="text-align: left;">Number of neighboring points to use in local approximations of manifold structure</td>
</tr>
</tbody>
</table>
<p>To run Step 3, use the following command:</p>
<pre><code>bash $SCRNABOX_HOME/launch_scrnabox.sh \
-d ${SCRNABOX_PWD} \
--steps 3 
</code></pre>
<p>The resulting output files are deposited into <code>~/working_directory/step3</code></p>
<h3 id="step-4-doublet-removal">Step 4: Doublet removal</h3>
<p>Doublets are identified and removed from downstream analysis (optional) using the DoubletFinder tool (McGinnis et al. 2019).  <br />
<br />
The following parameters are adjustable for Step 4:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Default</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">par_save_RNA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether or not to export an RNA expression matrix</td>
</tr>
<tr>
<td style="text-align: left;">par_save_metadata</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether or not to export a metadata dataframe</td>
</tr>
<tr>
<td style="text-align: left;">par_dropDN</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Whether or not to remove predicted doublets from downstream analyses</td>
</tr>
<tr>
<td style="text-align: left;">par_PCs</td>
<td style="text-align: left;">20</td>
<td style="text-align: left;">The number of statistically significant principal components. Can be informed by elbow plot produced in Step 3</td>
</tr>
<tr>
<td style="text-align: left;">par_pN</td>
<td style="text-align: left;">0.25</td>
<td style="text-align: left;">The number of artificial doublets to generate. DoubletFinderr is largely invariant to this parameter. We suggest keeping 0.25</td>
</tr>
<tr>
<td style="text-align: left;">par_sct</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">Logical representing whether SCTransform was used during original Seurat object pre-processing</td>
</tr>
<tr>
<td style="text-align: left;">par_sample_names</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">A list of sample names for each sample in the experiement, corresponding to the expected doublet rates listed in the parameter below. Sample names should be the same as those used to produce the <code>samples_info</code> folder during the setup procedures.</td>
</tr>
<tr>
<td style="text-align: left;">par_expected_doublet_rate</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">A list of expected doublet rates for each sample, corresponding to the sample names listed in the above parameter</td>
</tr>
</tbody>
</table>
<p>To run Step 4, use the following command:</p>
<pre><code>bash $SCRNABOX_HOME/launch_scrnabox.sh \
-d ${SCRNABOX_PWD} \
--steps 4 
</code></pre>
<p>The resulting output files are deposited into <code>~/working_directory/step4</code></p>
<h3 id="step-5-integration-and-linear-dimensional-reduction">Step 5: Integration and linear dimensional reduction</h3>
<p>Individual Seurat objects are integrated to enable the joint analysis across samples runs using Seurat's integration algorithm (Stuart et al. 2019); if experiments are limited to a single sequencing run, the integration Step can be bypassed. Normalization, scaling, and Linear dimensional reduction is then performed on the resulting Seurat object to inform the optimal parameters for clustering in Step 6.<br />
<br />
The following parameters are adjustable for Step 5:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Default</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">par_save_RNA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether or not to export an RNA expression matrix</td>
</tr>
<tr>
<td style="text-align: left;">par_save_metadata</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether or not to export a metadata dataframe</td>
</tr>
<tr>
<td style="text-align: left;">par_skip_integration</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether or not to skip integration. This is applicable for experiments that comprises of only one sequencing run.</td>
</tr>
<tr>
<td style="text-align: left;">par_FindIntegrationAnchors_dim</td>
<td style="text-align: left;">25</td>
<td style="text-align: left;">Which dimensions to use from the canonical correlation analysis (CCA) to specify the neighbor search space</td>
</tr>
<tr>
<td style="text-align: left;">par_DefaultAssay</td>
<td style="text-align: left;">RNA</td>
<td style="text-align: left;">The assay to perform normalization, scaling, and linear dimensiona reduction on. For most use cases this will be RNA.</td>
</tr>
<tr>
<td style="text-align: left;">par_normalization.method</td>
<td style="text-align: left;">LogNormalize</td>
<td style="text-align: left;">Method to use for normalization</td>
</tr>
<tr>
<td style="text-align: left;">par_selection.method</td>
<td style="text-align: left;">vst</td>
<td style="text-align: left;">Method for detecting top variable features</td>
</tr>
<tr>
<td style="text-align: left;">par_nfeatures</td>
<td style="text-align: left;">2500</td>
<td style="text-align: left;">Number of features to select as top variable features</td>
</tr>
<tr>
<td style="text-align: left;">par_RunUMAP_n.neighbors</td>
<td style="text-align: left;">65</td>
<td style="text-align: left;">Number of neighboring points used in local approximations of manifold structure</td>
</tr>
<tr>
<td style="text-align: left;">par_RunPCA_npcs</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">Total Number of principal components to compute and store for principal component analysis (PCA)</td>
</tr>
<tr>
<td style="text-align: left;">par_RunUMAP_dims</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">Number of dimensions to use as input features for uniform manifold approximation and projection (UMAP)</td>
</tr>
<tr>
<td style="text-align: left;">par_compute_jackstraw</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether or not to perform JackStraw computation. This computation takes a long time.</td>
</tr>
</tbody>
</table>
<p>To run Step 5, use the following command:</p>
<pre><code>bash $SCRNABOX_HOME/launch_scrnabox.sh \
-d ${SCRNABOX_PWD} \
--steps 5 
</code></pre>
<p>The resulting output files are deposited into <code>~/working_directory/step5</code></p>
<h3 id="step-6-clustering">Step 6: Clustering</h3>
<p>Clustering is performed to define groups of cells with similar expression profiles using the graph-based clustering approach implemented in the Seurat framework (Macosko et al. 2015).<br />
<br />
The following parameters are adjustable for Step 6:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Default</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">par_save_RNA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether or not to export an RNA expression matrix</td>
</tr>
<tr>
<td style="text-align: left;">par_save_metadata</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether or not to export a metadata dataframe</td>
</tr>
<tr>
<td style="text-align: left;">par_skip_step5</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether or not the user skipped integration in Step 5</td>
</tr>
<tr>
<td style="text-align: left;">par_FindNeighbors_dims</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">Number of dimensions from linear dimensional reduction used as input to identify neighbours. Can be informed by the elbow and Jackstraw plots produced in Step 5</td>
</tr>
<tr>
<td style="text-align: left;">par_FindNeighbors_k.param</td>
<td style="text-align: left;">60</td>
<td style="text-align: left;">Defines k for the k-nearest neighbor algorithm</td>
</tr>
<tr>
<td style="text-align: left;">par_FindNeighbors_prune.SNN</td>
<td style="text-align: left;">1/15</td>
<td style="text-align: left;">Sets the cutoff for acceptable Jaccard index when computing the neighborhood overlap for the shared nearest-neighbour (SNN) construction</td>
</tr>
<tr>
<td style="text-align: left;">par_FindClusters_resolution</td>
<td style="text-align: left;">0.1 to 0.9, in intervals of 0.1</td>
<td style="text-align: left;">Value of the clustering resolution parameter. You may provide multiple resolution values</td>
</tr>
<tr>
<td style="text-align: left;">par_compute_ARI</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Whether or not you want to compute the Adjusted Rand Index (ARI) between clusters at a given clustering resolution</td>
</tr>
<tr>
<td style="text-align: left;">par_RI_reps</td>
<td style="text-align: left;">100</td>
<td style="text-align: left;">Number of iterations for clustering the data at a given resolution in order to calculate the ARI</td>
</tr>
</tbody>
</table>
<p>To run Step 6, use the following command:</p>
<pre><code>bash $SCRNABOX_HOME/launch_scrnabox.sh \
-d ${SCRNABOX_PWD} \
--steps 6 
</code></pre>
<p>The resulting output files are deposited into <code>~/working_directory/step6</code></p>
<h3 id="step-7-cluster-annotation">Step 7: Cluster annotation</h3>
<p>Cell populations, or clusters, with similar expression profiles are annotated to define cell types by three distinct methods:<br />
<br />
 <strong>Method 1. Cluster marker gene set enrichment analysis (GSEA)</strong>: Seurat's <em>FindAllMarkers</em> function is used to identify differentially expressed marker genes (DEG) by the Wilcoxon rank-sum test (Macosko et al. 2015). DEGs in the positive direction     (Log2 fold-change &gt; 0.00) are then tested for enrichment across user-defined gene set libraries that define cell types using the EnrichR tool (Chen et al. 2013).<br />
 <br />
 <strong>Method 2. Module score</strong>: Seurat’s implementation (<em>AddModuleScore</em>) of Tirosh et al.’s algorithm is used to comparatively quantify the expression of gene sets across clusters at the single-cell level (Tirosh et al. 2016). Users must          define their desired gene sets in the parameters file of Step 7. Gene sets should be defined in a csv file, where the column names correspond to the arbitrary name of the gene set and the corresponding rows define the genes in the gene set. For example: <br /></p>
<table>
<thead>
<tr>
<th style="text-align: left;">gene_set_1</th>
<th style="text-align: left;">gene_set_2</th>
<th style="text-align: left;">gene_set_3</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">CLDN5</td>
<td style="text-align: left;">IFITM3</td>
<td style="text-align: left;">TM4SF1</td>
</tr>
<tr>
<td style="text-align: left;">ANGPT2</td>
<td style="text-align: left;">EGFL7</td>
<td style="text-align: left;">IGFBP</td>
</tr>
<tr>
<td style="text-align: left;">FLT1</td>
<td style="text-align: left;">A2M</td>
<td style="text-align: left;">GIMAP7</td>
</tr>
<tr>
<td style="text-align: left;">DEPP1</td>
<td style="text-align: left;">SOD2</td>
<td style="text-align: left;">EMP2</td>
</tr>
<tr>
<td style="text-align: left;">TMSB10</td>
<td style="text-align: left;">PODXL</td>
<td style="text-align: left;">B2M</td>
</tr>
<tr>
<td style="text-align: left;">HLA-E</td>
<td style="text-align: left;">VWF</td>
<td style="text-align: left;">BST2</td>
</tr>
<tr>
<td style="text-align: left;">SLCO4A1</td>
<td style="text-align: left;">PECAM1</td>
<td style="text-align: left;">BSG</td>
</tr>
<tr>
<td style="text-align: left;">TGM2</td>
<td style="text-align: left;">SLC2A3</td>
<td style="text-align: left;">PARP14</td>
</tr>
<tr>
<td style="text-align: left;">IFI27</td>
<td style="text-align: left;">TSC22D1</td>
<td style="text-align: left;">NFKBIA</td>
</tr>
<tr>
<td style="text-align: left;">MT2A</td>
<td style="text-align: left;">HLA-B</td>
<td style="text-align: left;">ID3</td>
</tr>
<tr>
<td style="text-align: left;">EPAS1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">IFITM2</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p><br /> 
 <strong>Method 3. Reference-based annotation</strong>: Seurat's <em>FindTransferAnchors</em> and <em>TransferData</em> functions are used to leverage cell-type annotations from a reference Seurat object and generate annotation predictions for the query dataset (Macosko et        al. 2015). User's must define the location of their referene Seurat object in the parameters file of Step 7.<br />
 <br />
 In addition, scRNAbox allows users to <strong>visualize the expression of select features</strong> at the cluster or cell level via a user-provided list of gene identifiers in order to further inform the cellular species that make up specific clusters. </p>
<p>The following parameters are adjustable for Step 7:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Default</th>
<th style="text-align: left;">Description (the cluster annotation method associated with the parameter is shown)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">par_save_RNA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether or not to export an RNA expression matrix</td>
</tr>
<tr>
<td style="text-align: left;">par_save_metadata</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether or not to export a metadata dataframe</td>
</tr>
<tr>
<td style="text-align: left;">par_level_cluster</td>
<td style="text-align: left;">integrated_snn_res.0.7</td>
<td style="text-align: left;">The cluster resolution that you want to use for downstream analyses. If you skipped integration in Step 5, use par_level_cluster='RNA_snn_res.0.7', if you want to proceed with a clustering resolution of 0.7</td>
</tr>
<tr>
<td style="text-align: left;">par_top_sel</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;"><strong>Method 1:</strong> Number of top markers to identify based on avg_log2FC</td>
</tr>
<tr>
<td style="text-align: left;">par_db</td>
<td style="text-align: left;">Descartes_Cell_Types_and_Tissue_2021,<br /> CellMarker_Augmented_2021,<br />Azimuth_Cell_Types_2021</td>
<td style="text-align: left;"><strong>Method 1:</strong> Character vector of EnrichR databases that define cell types. The top marker genes for each cluster will be tested for enrichment across these databases.</td>
</tr>
<tr>
<td style="text-align: left;">par_compute_module_score</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;"><strong>Method 2:</strong> Whether or not to perform the module score computation</td>
</tr>
<tr>
<td style="text-align: left;">par_compute_module_score</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;"><strong>Method 2:</strong> Whether or not to perform the module score computation</td>
</tr>
<tr>
<td style="text-align: left;">par_module_score</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;"><strong>Method 2:</strong> Path defining the location of the directory that contains the csv file of the gene sets used to compute the module score</td>
</tr>
<tr>
<td style="text-align: left;">par_reference</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;"><strong>Method 3:</strong> Path defining the location of the reference Seurat object</td>
</tr>
<tr>
<td style="text-align: left;">par_level_celltype</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;"><strong>Method 3:</strong> The name of the metadata column in the reference Seurat object that defines cell types</td>
</tr>
<tr>
<td style="text-align: left;">par_FindTransferAnchors_dim</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;"><strong>Method 3:</strong> Number of dimensions from linear dimensional reduction used to find transfer anchors between the reference and query Seurat objects</td>
</tr>
<tr>
<td style="text-align: left;">par_futureglobalsmaxSize</td>
<td style="text-align: left;">50000 * 1024^2</td>
<td style="text-align: left;"><strong>Method 3:</strong> This will increase your RAM usage so set this number mindfully</td>
</tr>
<tr>
<td style="text-align: left;">par_visualize_select_features</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;"><strong>Visualize select features:</strong> Whether or not to visualize select features</td>
</tr>
<tr>
<td style="text-align: left;">par_select_features</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;"><strong>Visualize select features:</strong> list of gene identifiers to visualize the expression of select features</td>
</tr>
</tbody>
</table>
<p>To identify cluster marker genes (<strong>Method 1</strong>), compute the module score for user-defined gene sets (<strong>Method 2</strong>), and <strong>visualize select features</strong>, use the following command:</p>
<pre><code>bash $SCRNABOX_HOME/launch_scrnabox.sh \
-d ${SCRNABOX_PWD} \
--steps 7 \
--marker T
</code></pre>
<p>Then, to test the top cluster marker genes for enrichment across gene set libraries that define cell types (<strong>Method 1</strong>), use the following command:</p>
<pre><code>bash $SCRNABOX_HOME/launch_scrnabox.sh \
-d ${SCRNABOX_PWD} \
--steps 7 \
--enrich T
</code></pre>
<p>Please note that in order to test the cluster marker genes for enrichment across EnrichR libraries, the HPC must have access to the internet. If your HPC cannot access the internet, it is possible to run the enrichment step on your local machine directly in R. To do so, begin by downloading the Step 6 Seurat RDS object (<code>~/working_directory/step6/objs6/seu_step6.rds</code>)  and cluster marker RDS object (<code>~/working_directory/step7/info7/marker/ClusterMarkers.rds</code>) to your computer using the following commands</p>
<pre><code>scp username@beluga.computecanada.ca:~/working_directory/step7/info7/marker/ClusterMarkers.rds  ~/Desktop/working_directory
scp username@beluga.computecanada.ca:~/working_directory/step6/objs6/seu_step6.rds  ~/Desktop/working_directory

</code></pre>
<p>Then run the follwing code in R:</p>
<pre><code>SCRNABOX_PWD &lt;- &quot;~/Desktop/working_directory&quot;
dir.create(&quot;SCRNABOX_PWD/step7/annot&quot;)
level_cluster='integrated_snn_res.0.7'
ClusterMarkers='SCRNABOX_PWD/step7/info7/ClusterMarkers.rds'
PWD='SCRNABOX_PWD/step7/annot/'
PSUE='SCRNABOX_PWD/step6/objs6/seu_step6.rds'
top_sel=5
db &lt;- c('Descartes_Cell_Types_and_Tissue_2021','CellMarker_Augmented_2021','Azimuth_Cell_Types_2021')
scrnaboxR::annotation(level_cluster,ClusterMarkers,PWD,PSUE,top_sel,db)
</code></pre>
<p>To perform reference-based annotation (<strong>Method 3</strong>), run the following command: </p>
<pre><code>bash $SCRNABOX_HOME/launch_scrnabox.sh \
-d ${SCRNABOX_PWD} \
--steps 7 \
--fta T
</code></pre>
<p>The resulting output files are deposited into <code>~/working_directory/step7</code>.</p>
<h3 id="step-8-differential-gene-expression-contrasts">Step 8: Differential gene expression contrasts</h3>
<p>This step performs differetial gene expression (DGE) analyses according to user-defined contrasts. Contrast can be performed between samples (e.g. case vs control; <strong>sample-sample contrasts</strong>) or between samples, stratified by cell type (e.g. case vs control for excitatory neurons only; <strong>sample-cell contrasts</strong>).</p>
<p>The following parameters are adjustable for Step 8:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Default</th>
<th style="text-align: left;">Description (the cluster annotation method associated with the parameter is shown)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">par_save_RNA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether or not to export an RNA expression matrix</td>
</tr>
<tr>
<td style="text-align: left;">par_save_metadata</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Whether or not to export a metadata dataframe</td>
</tr>
<tr>
<td style="text-align: left;">par_level_cluster</td>
<td style="text-align: left;">integrated_snn_res.0.7</td>
<td style="text-align: left;">The cluster resolution that you used in the cluster annotation module. If you skipped integration in Step 5, use par_level_cluster='RNA_snn_res.0.7', if you want to proceed with a clustering resolution of 0.7</td>
</tr>
<tr>
<td style="text-align: left;">par_step8_clus_label</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">List of user-currated cluster labels obtained from the annotation module. Make sure to have the same number of labels as clusters at the desired clustering resolution.</td>
</tr>
<tr>
<td style="text-align: left;">par_new_genotype</td>
<td style="text-align: left;">yes</td>
<td style="text-align: left;">Whether or not you want to add new sample labels to simplify the contrasts. For example, you may wish to set both control1 and control2 as control.</td>
</tr>
<tr>
<td style="text-align: left;">par_old_sample_label</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">list of old sample labels (i.e. those used to create the samples_info folder in the setup procedures)</td>
</tr>
<tr>
<td style="text-align: left;">par_new_sample_label</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">list of new sample labels corresponding to the old sample labels defined in the parameter above</td>
</tr>
</tbody>
</table>
<p>The first step of the DGE contrasts module is to create a  DGEListobject. This step may require alot of RAM, we suggest 3*size(seu_int_clu.rds). Users can adjust the RAM in the <code>scrnabox_config.ini</code> file located in <code>~/working_directory/job_info/configs</code>. To create a DGEListobject, run the following command:</p>
<pre><code>bash $SCRNABOX_HOME/launch_scrnabox.sh \
-d ${SCRNABOX_PWD} \
--steps 8 \
--dgelist T
</code></pre>
<p>The next step is to perform DGE contrasts. As mentioned, useers can perform <strong>sample-sample contrasts</strong> or <strong>sample-cell contrasts</strong></p>
<p>To perform <strong>sample-sample contrasts</strong>, users must first modify the <code>step8_contrast_genotype.txt</code> contrast matrix located in <code>~/working_directory/job_info/parameters</code>. The contrast matrix comprises three columns that define the arbitrary name of the contrast (cont_name), the control sample (control), and the case sample (versus). For example:</p>
<pre><code>cont_name control versus
design1 control case1,case2,case3,case4,case5
design2 control case1
design3 control case2
design4 control case3
design5 control case4
design6 control case5
design7 control case1,case2,case3,case4
design8 control case1,case2,case3
design9 control case1,case2
</code></pre>
<p>To perform <strong>sample-sample contrasts</strong>, run the following command:</p>
<pre><code>bash $SCRNABOX_HOME/launch_scrnabox.sh \
-d ${SCRNABOX_PWD} \
--steps 8 \
--genotype T
</code></pre>
<p>To perform <strong>sample-cell contrasts</strong>, users must first modify the <code>step8_contrast_celltype.txt</code> contrast matrix located in <code>~/working_directory/job_info/parameters</code>. The contrast matrix comprises four columns that define the arbitrary name of the contrast (cont_name), the cell type (cell), the control sample (control), and the case sample (versus). For example:</p>
<pre><code>cont_name cell control versus
design1 excitatory_neuron control case1,case2,case3,case4,case5
design2 excitatory_neuron control case1
design3 excitatory_neuron control case2
design4 excitatory_neuron control case3
design5 excitatory_neuron control case4
design6 excitatory_neuron control case5
design7 excitatory_neuron control case1,case2,case3,case4
design8 excitatory_neuron control case1,case2,case3
design9 excitatory_neuron control case1,case2
</code></pre>
<p>To perform <strong>sample-cell contrasts</strong>, run the following command:</p>
<pre><code>bash $SCRNABOX_HOME/launch_scrnabox.sh \
-d ${SCRNABOX_PWD} \
--steps 8 \
--celltype T
</code></pre>
<p>The resulting output files are deposited into <code>~/working_directory/step8</code>.</p>
<p><strong>Note:</strong> that if you have a large number of contrasts to run, it may be more efficient to split them up and submit batch jobs instead.</p>
<h2 id="integrating-seurat-objects">Integrating Seurat objects</h2>
<p>To combine different seurat objects, you can run the following codes. </p>
<pre><code>LISTOFSEU=~/list.txt

bash $SCRNABOX_HOME/launch_scrnabox.sh \
-d ${SCRNABOX_PWD} \
--steps  integrate \
--seulist ${LISTOFSEU} \
</code></pre>
<p>LISTOFSEU includes the path of seurate files, put them in different lines. By default, the pipeline standardize the seurat objects before integrating, you can change the default in <code>${SCRNABOX_PWD}/job_output/parameters/stepint_par.txt</code>.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../installation/" class="btn btn-neutral float-left" title="Installation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../HTO/" class="btn btn-neutral float-right" title="- Cell hashtags">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../installation/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../HTO/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
